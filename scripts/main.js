var ads = [{
  width: 320,
  height: 480,
  tag: '<meta charset="utf-8"><style>body{margin:0;padding:0;}.link{position:absolute;background:#eee;min-width:320px;min-height:480px;width:100%;height:100%;overflow:hidden;top:0;left:0;text-decoration:none !important;}.ad{position:absolute;top:10px;left:10px;right:10px;bottom:10px;font-family:\'Helvetica\', sans-serif;background:#fff;box-sizing:content-box;text-align:center;border-radius:3px;overflow:hidden;box-shadow:0 1px 0px #ddd;border:1px solid #ddd;}.asset{position:absolute;top:0;left:0;right:0;height:40%;background-size:cover;background-repeat:no-repeat;}.container{position:absolute;margin-top:-36px;top:40%;left:0;right:0;bottom:0;padding:0 15px;}img{width:72px;height:72px;border-radius:3px;}h1{padding:0;margin:20px 0;font-size:20px;font-weight:400;color:#333;}p{color:#4a4a4a;font-size:16px;margin:20px 0;font-weight:100;}.button-container{position:absolute;bottom:20px;left:0;right:0;}button{margin:0 auto;border-radius:3px;background:#1bc738;color:#fff;font-weight:400;outline:0;border:0;padding:10px 15px;font-size:14px;}</style><meta name="viewport" content="width=device-width, initial-scale=1"><a class="link" href="{click_url}" data-field="container" style="background: rgb(255, 255, 255); border: none; transform: none;"><div class="ad" data-field="adContainer" style="background: linear-gradient(0deg, rgb(255, 255, 255), rgb(97, 233, 29)); border: none; transform: none;"><div class="asset" style="background-image: url(&quot;https://s3.amazonaws.com/creatives.jampp.com/assets/344/1200x627_N7ws_jWswMH5vV8WgbkTuA.jpg&quot;); border: none; transform: none;" data-field="media"></div><div class="container"><img src="https://s3.amazonaws.com/creatives.jampp.com/jua34gX6kTHGkp0HxCdGAw.jpeg"><h1 data-field="headline" style="text-align: center; color: rgb(51, 51, 51); font-weight: 600; border: none; transform: none;">100 000 billets à partir de 4,99€</h1><p data-field="promoText" style="text-align: center; color: rgb(74, 74, 74); border: none; transform: none;">Offre spéciale Nouvel an chez FlixBus ! Obtiens ton billet à 4,99€ ou 8,99€ avant le 07.01</p><div class="button-container"><button data-field="callToAction" style="background: rgb(255, 170, 0); color: rgb(255, 255, 255); border: none; transform: none;">Réservez ici!</button></div></div></div></a> <script type="text/javascript">var anchor = document.querySelector(\'a\');anchor.href+=\'&executed=1\';var params=\'\';function appendClickPosition(x,y){if(params===\'\'){params+=\'&touchX=\'+parseFloat(x/anchor.offsetWidth).toFixed(3)+\'&touchY=\'+parseFloat(y/anchor.offsetHeight).toFixed(3);anchor.href+=params;}}anchor.addEventListener(\'touchstart\',function(e){if(e.touches[0]){appendClickPosition(e.touches[0].pageX,e.touches[0].pageY)}});anchor.onclick=function(e){appendClickPosition(e.clientX,e.clientY)};</script>',
}, {
  width: 320,
  height: 50,
  tag: '<meta charset="utf-8"><style>body{margin:0;padding:0;}.link{position:absolute;min-width:320px;min-height:50px;width:100%;height:100%;overflow:hidden;top:0;left:0;text-decoration:none !important;}.ad{position:absolute;top:0px;left:0px;right:0px;bottom:0px;font-family:\'Helvetica\', sans-serif;background:#fefefe;box-sizing:content-box;padding:4px;text-align:right;}.advertiser{float:left;width:63%;text-align:left;}div.flip-container{position:relative;width:42px;height:42px;display:inline-block;vertical-align:middle;margin-right:5px;}.flip1,.flip2{position:absolute;top:0;width:100%;height:100%;border-radius:5px;object-fit:cover;transform-style:preserve-3d;backface-visibility:hidden;}img.flip1{z-index:1;animation:2s linear infinite alternate flip1;}img.flip2{z-index:2;animation:2s linear infinite alternate flip2;}.text{width:72%;display:inline-block;max-height:42px;vertical-align:middle;}h1{margin:0;padding:0;font-size:14px;font-weight:700;color:#333;line-height:16px;margin-bottom:3px;display:inline-block;}p{display:inline-block;line-height:12px;color:#4a4a4a;font-size:12px;margin:0;}button{border-radius:5px;background:#1bc738;color:#fff;letter-spacing:0.3px;font-weight:400;outline:0;border:0;padding:6px 8px;font-size:12px;margin-top:8px;margin-right:4px;}@-webkit-keyframes \'flip1\'{0%{-webkit-transform:perspective(0px) rotateY(180deg);}50%{-webkit-transform:perspective(0px) rotateY(90deg);opacity:1;}100%{-webkit-transform:perspective(0px) rotateY(0deg);}}@-webkit-keyframes \'flip2\'{0%{-webkit-transform:perspective(0px);}49%{opacity:1;}50%{-webkit-transform:perspective(0px) rotateY(90deg);opacity:0;}100%{-webkit-transform:perspective(0px) rotateY(180deg);opacity:0;}}</style><meta name="viewport" content="width=device-width, initial-scale=1"><a class="link" href="{click_url}"><div class="ad" data-field="adContainer" style="background: linear-gradient(0deg, rgb(255, 255, 255), rgb(97, 233, 29)); border: none; transform: none;"><div class="advertiser"><div class="flip-container"><img class="flip1" src="https://s3.amazonaws.com/creatives.jampp.com/jua34gX6kTHGkp0HxCdGAw.jpeg"><img class="flip2" src="https://s3.amazonaws.com/creatives.jampp.com/assets/344/1200x627_N7ws_jWswMH5vV8WgbkTuA.jpg" data-field="media" style="border: none; transform: none;"></div><div class="text"><h1 data-field="headline" style="text-align: center; color: rgb(51, 51, 51); font-weight: 600; border: none; transform: none;">100 000 billets à partir de 4,99€</h1><div><p data-field="promoText" style="text-align: center; color: rgb(74, 74, 74); border: none; transform: none;">Offre spéciale Nouvel an chez FlixBus ! Obtiens ton billet à 4,99€ ou 8,99€ avant le 07.01</p></div></div></div><button data-field="callToAction" style="background: rgb(255, 170, 0); color: rgb(255, 255, 255); border: none; transform: none;">Réservez ici!</button></div></a> <script type="text/javascript">var anchor = document.querySelector(\'a\');anchor.href+=\'&executed=1\';var params=\'\';function appendClickPosition(x,y){if(params===\'\'){params+=\'&touchX=\'+parseFloat(x/anchor.offsetWidth).toFixed(3)+\'&touchY=\'+parseFloat(y/anchor.offsetHeight).toFixed(3);anchor.href+=params;}}anchor.addEventListener(\'touchstart\',function(e){if(e.touches[0]){appendClickPosition(e.touches[0].pageX,e.touches[0].pageY)}});anchor.onclick=function(e){appendClickPosition(e.clientX,e.clientY)};</script>',
}, {
  width: 300,
  height: 250,
  tag: '<meta charset="utf-8"><style>body{margin:0;padding:0;}.link{position:absolute;background:#eee;min-width:300px;min-height:250px;width:100%;height:100%;overflow:hidden;top:0;left:0;text-decoration:none !important;}.ad{position:absolute;top:0;left:0;right:0;bottom:0;font-family:\'Helvetica\', sans-serif;background:#fff;box-sizing:content-box;text-align:center;}.asset{position:absolute;top:0;left:0;right:0;height:40%;background-size:cover;background-repeat:no-repeat;}.container{position:absolute;margin-top:-27px;top:40%;left:0;right:0;bottom:0;}img{width:54px;height:54px;border-radius:3px;}h1{padding:0;margin:7px 10px;font-size:18px;font-weight:400;color:#333;}p{color:#4a4a4a;font-size:14px;margin:7px 10px;font-weight:100;}.button-container{position:absolute;bottom:10px;left:0;right:0;}button{margin:0 auto;border-radius:3px;background:#1bc738;color:#fff;font-weight:400;outline:0;border:0;padding:8px 10px;font-size:13px;}</style><meta name=\'viewport\' content=\'width=device-width, initial-scale=1\'><a class=\'link\' href=\'{click_url}\'><div class=\'ad\' data-field=\'adContainer\'><div class=\'asset\' style=\'background-image: url(https://s3.amazonaws.com/creatives.jampp.com/assets/344/1200x627_l7Es5iOuS8GFK6O89mz9hg.jpg)\' data-field=\'media\'></div><div class=\'container\'><img src=\'https://s3.amazonaws.com/creatives.jampp.com/jua34gX6kTHGkp0HxCdGAw.jpeg\'><h1 data-field=\'headline\'>100 000 billets à partir de 4,99€</h1><p data-field=\'promoText\'>Offre spéciale Nouvel an chez FlixBus ! Obtiens ton billet à 4,99€ ou 8,99€ avant le 07.01</p><div class=\'button-container\'><button data-field=\'callToAction\'>Réservez ici!</button></div></div></div></a> <script type="text/javascript">var anchor = document.querySelector(\'a\');anchor.href+=\'&executed=1\';var params=\'\';function appendClickPosition(x,y){if(params===\'\'){params+=\'&touchX=\'+parseFloat(x/anchor.offsetWidth).toFixed(3)+\'&touchY=\'+parseFloat(y/anchor.offsetHeight).toFixed(3);anchor.href+=params;}}anchor.addEventListener(\'touchstart\',function(e){if(e.touches[0]){appendClickPosition(e.touches[0].pageX,e.touches[0].pageY)}});anchor.onclick=function(e){appendClickPosition(e.clientX,e.clientY)};</script>',
}, {
  width: 300,
  height: 250,
  tag: '<meta charset="utf-8"><style>body{margin:0;padding:0;}.link{position:absolute;background:#eee;min-width:300px;min-height:250px;width:100%;height:100%;overflow:hidden;top:0;left:0;text-decoration:none !important;}.ad{position:absolute;top:0;left:0;right:0;bottom:0;font-family:\'Helvetica\', sans-serif;background:#fff;box-sizing:content-box;text-align:center;}.asset{position:absolute;top:0;left:0;right:0;height:40%;background-size:cover;background-repeat:no-repeat;}.container{position:absolute;margin-top:-27px;top:40%;left:0;right:0;bottom:0;}img{width:54px;height:54px;border-radius:3px;}h1{padding:0;margin:7px 10px;font-size:18px;font-weight:400;color:#333;}p{color:#4a4a4a;font-size:14px;margin:7px 10px;font-weight:100;}.button-container{position:absolute;bottom:10px;left:0;right:0;}button{margin:0 auto;border-radius:3px;background:#1bc738;color:#fff;font-weight:400;outline:0;border:0;padding:8px 10px;font-size:13px;}</style><meta name=\'viewport\' content=\'width=device-width, initial-scale=1\'><a class=\'link\' href=\'{click_url}\'><div class=\'ad\' data-field=\'adContainer\'><div class=\'asset\' style=\'background-image: url(https://s3.amazonaws.com/creatives.jampp.com/assets/344/1200x627_l7Es5iOuS8GFK6O89mz9hg.jpg)\' data-field=\'media\'></div><div class=\'container\'><img src=\'https://s3.amazonaws.com/creatives.jampp.com/jua34gX6kTHGkp0HxCdGAw.jpeg\'><h1 data-field=\'headline\'>100 000 billets à partir de 4,99€</h1><p data-field=\'promoText\'>Offre spéciale Nouvel an chez FlixBus ! Obtiens ton billet à 4,99€ ou 8,99€ avant le 07.01</p><div class=\'button-container\'><button data-field=\'callToAction\'>Réservez ici!</button></div></div></div></a> <script type="text/javascript">var anchor = document.querySelector(\'a\');anchor.href+=\'&executed=1\';var params=\'\';function appendClickPosition(x,y){if(params===\'\'){params+=\'&touchX=\'+parseFloat(x/anchor.offsetWidth).toFixed(3)+\'&touchY=\'+parseFloat(y/anchor.offsetHeight).toFixed(3);anchor.href+=params;}}anchor.addEventListener(\'touchstart\',function(e){if(e.touches[0]){appendClickPosition(e.touches[0].pageX,e.touches[0].pageY)}});anchor.onclick=function(e){appendClickPosition(e.clientX,e.clientY)};</script>',
}]

var adsHasAppended = false

$(document).ready(function() {
  if (!adsHasAppended) {
    adsHasAppended = true

    var deviceTemplate = $('#jampp__Carousel__Slide')

    for (var adIndex = 0; adIndex < ads.length; adIndex++) {
      var ad = ads[adIndex]

      var carouselSlide = $(deviceTemplate.clone().html())

      var adTag = ad.tag.replace(new RegExp('<style>', 'g'), '<style scoped>')


      carouselSlide
        .find('.jampp__Ad')
        .html($('<div class="jampp__Ad__Content" style="width:' + ad.width + 'px; height:' + ad.height + 'px"><div>' + adTag + '</div></div>'))

      $('.jampp__Carousel').append('<div>' + carouselSlide.html() + '</div>')

      var carouselSlideInserted = $('.jampp__Carousel').children(':last')

      scopeCss(carouselSlideInserted.find('.jampp__Ad__Content > div')[0], carouselSlideInserted.find('.jampp__Ad__Content')[0], 'adId' + adIndex)
    }

    $('.jampp__Carousel').slick({
      arrows: false,
      dots: false,
      infinite: false,
      slidesToShow: 3,
      slidesToScroll: 1,
      centerMode: true,
      focusOnSelect: true,
    })
  }
})

function scopeTag(tag, prefix) {
  const re = new RegExp('([^\r\n,{}]+)(,(?=[^}]*{)|\s*{)', 'g') // eslint-disable-line no-control-regex,no-useless-escape

  return tag.replace(re, (trash, rawElement, brackets) => {
    if (rawElement.match(/^\s*(@media|@.*keyframes|to|from|@font-face|1?[0-9]?[0-9])/)) {
      return `${rawElement}${brackets}`
    }

    let element = rawElement

    if (element.match(/:scope/)) {
      element = rawElement.replace(/([^\s]*):scope/, ((h0, h1) => {
        if (h1 === '') {
          return '> *'
        }
        return `> ${h1}`
      }))
    }

    element = element.replace(/^(\s*)/, `$1${prefix} `)

    return `${element}${brackets}`
  })
}

function scopeCss(element, originalDestination, prefix) {
  console.log(element)
  console.log(originalDestination)
  console.log(prefix)

  let destination = originalDestination

  destination.innerHTML = ''

  const styles = element.querySelectorAll('style[scoped]')

  const head = document.head || document.getElementsByTagName('head')[0]

  styles.forEach((style, styleIndex) => {
    const styleTag = style.innerHTML

    if (styleTag !== null) {
      const styleId = `${prefix}_${styleIndex}`
      const stylePrefix = `#${styleId}`

      const wrapperNode = document.createElement('span')
      wrapperNode.id = styleId

      destination = destination.appendChild(wrapperNode)
      wrapperNode.appendChild(style.parentNode)
      style.parentNode.removeChild(style)

      if (document.querySelector(`[data-id=${styleId}]`) === null) {
        const scopedStyleTag = scopeTag(styleTag, stylePrefix)

        const newStyle = document.createElement('style')
        newStyle.dataset.id = styleId

        newStyle.appendChild(document.createTextNode(scopedStyleTag))

        head.appendChild(newStyle)
      }
    }
  })
}
